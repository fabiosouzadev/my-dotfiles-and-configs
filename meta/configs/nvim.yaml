- shell:
  - description: Validating sudo credentials
    command: "sudo --validate" 
  - description: Create source dir 
    command: "[ -d $HOME/.local/src ] || mkdir -p $HOME/.local/src"
  - description: Build prerequisites
    command: | 
      case $(lsb_release -is) in 

      Ubuntu)
        sudo apt-get install -y ninja-build \
          gettext \
          libtool \
          libtool-bin \
          autoconf \
          automake \
          cmake \
          g++ \
          pkg-config \
          unzip \
          curl \
          doxygen
        ;;

      Arch)
        sudo pacman -S --noconfirm base-devel \
          cmake \
          unzip \
          ninja \
          tree-sitter \
          curl
        ;;
      esac
  - description: Build neovim
    command: | 
      [ -d $HOME/.local/src/neovim ] || git clone https://github.com/neovim/neovim $HOME/.local/src/neovim
      cd $HOME/.local/src/neovim
      sudo make distclean && sudo make CMAKE_BUILD_TYPE=RelWithDebInfo
      git checkout v0.8.2
      sudo make install
  - description: Install packer.nvim
    command: '[ ! -f $HOME/.local/share/nvim/site/pack/packer ] || git clone --depth 1 https://github.com/wbthomason/packer.nvim ~/.local/share/nvim/site/pack/packer/start/packer.nvim'

- link:
    ~/.config/nvim: nvim
